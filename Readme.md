# Medication Data Insertion Project

## Описание проекта

Этот проект предназначен для обработки данных о лекарственных препаратах и их инструкциях. Он извлекает информацию с сайта ГРЛС, обрабатывает данные и создаёт скрипт для вставки данных в PostgreSQL. В частности, проект включает в себя извлечение данных о торговых наименованиях, держателях регистрационных удостоверений, фармакологических группах и формах выпуска. Также производится извлечение текста инструкций из PDF-файлов и их вставка в соответствующую таблицу.

### Структура таблиц

1. **Medications**: Содержит информацию о лекарствах, включая их торговое наименование, держателя, фармакологическую группу и форму выпуска.
2. **LegalEntities**: Содержит информацию о производителях лекарств.
3. **PharmacologicalGroups**: Содержит фармакологические группы препаратов.
4. **ReleaseForms**: Содержит формы выпуска для препаратов, включая дозировку и количество таблеток в упаковке.
5. **Instructions**: Содержит инструкции для лекарств, извлечённые из PDF-файлов.

## Требования

- Python 3.7+
- Pandas
- PyMuPDF (или PyPDF2 для извлечения текста из PDF)
- psycopg2 или sqlalchemy (для работы с PostgreSQL)
- requests
- beautifulsoup4
- selenium

## Установка

1. Клонируйте репозиторий:

   ```bash
   git clone https://github.com/yourusername/medication-data-insertion.git
   cd medication-data-insertion
   ```

2. Создайте и активируйте виртуальное окружение:

   ```bash
   python -m venv .venv
   source .venv/bin/activate  # На Windows используйте .venv\Scripts\activate
   ```

3. Установите зависимости:

   ```bash
   pip install -r requirements.txt
   ```

## Использование

1. Запустите скрипт `parse_urls_grls.py` для получения ссылок на базу ГРЛС (возможно будет необходимо обновить токен). В процессе выполнения скрипта необходимо вводить капчу.
2. Выгрузите и подготовьте данные в формате CSV с использованием скрипта `parse_data.py`.
   
   Структура CSV будет иметь вид:

   | Торговое наименование | Наименование держателя | Страна держателя | Дозировка | Количество таблеток | Фармако-терапевтическая группа | Рецептурное | БАД | Файл с инструкцией |
   |-----------------------|------------------------|------------------|-----------|---------------------|------------------------------|-------------|-----|---------------------|
   | Примерное имя         | Примерное название     | Россия           | 10+20+30  | 10+20               | Обезболивающие               | True        | False | path/to/instruction.pdf |

3. Запустите скрипт для преобразования данных в SQL-скрипт:

   ```bash
   python insert_into_db.py
   ```

   Этот скрипт:
   - Обрабатывает данные в DataFrame.
   - Вставляет их в таблицы базы данных `Medications`, `LegalEntities`, `PharmacologicalGroups`, `ReleaseForms`, и `Instructions`.
   - Инструкции извлекаются из PDF-файлов по пути, указанному в столбце `Файл с инструкцией`.

## Структура проекта

```
medication-data-insertion/
│
├── insert_into_db.py         # Скрипт для формирования SQL-скрипта
├── parse_data.py             # Скрипт для парсинга страниц по их URL и формированию CSV файла
├── parse_urls_grls.py        # Скрипт для парсинга ссылок на страницы
├── requirements.txt          # Зависимости для проекта
├── data/                     # Папка с входными данными и инструкциями
├── README.md                 # Документация проекта
└── .venv/                    # Виртуальное окружение
```

## Пример SQL-запроса для вставки данных

Пример SQL-запроса, который генерируется для вставки данных о лекарственных препаратах и их инструкциях:

```sql
INSERT INTO core.Medications (trade_name, legal_entity_id, release_form_id, pharmacological_group_id, is_prescription, is_dietary_supplement)
VALUES ('Примерное имя', 1, 1, 1, true, false)
ON CONFLICT (trade_name) DO NOTHING;

INSERT INTO core.Instructions (medication_trade_name, content)
VALUES ('Примерное имя', 'Текст инструкции из PDF...')
ON CONFLICT (medication_trade_name, content) DO NOTHING;
```

## Лицензия

Этот проект лицензирован под MIT License - см. файл [LICENSE](LICENSE) для подробностей.

Проект был разработан исключительно в образовательных целях. Автор не несет ответственности за возможные ошибки, неправильное использование или любые последствия, связанные с использованием данного кода в реальных или коммерческих проектах.

Пожалуйста, используйте данный проект в соответствии с законодательством своей страны и в рамках установленных норм и стандартов.

## Благодарности

- [PyMuPDF](https://pypi.org/project/PyMuPDF/) - для извлечения текста из PDF.
- [Pandas](https://pandas.pydata.org/) - для обработки данных.
